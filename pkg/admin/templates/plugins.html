{{define "plugins.html"}}
{{template "base" .}}
{{end}}

{{define "title"}}{{.Title}} - Odin API Gateway Admin{{end}}

{{define "content"}}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>
    <i class="bi bi-plugin"></i> Plugins
  </h1>
  <a href="/admin/plugins/new" class="btn btn-primary">
    <i class="bi bi-plus-circle"></i> Add Plugin
  </a>
</div>

{{if .Plugins}}
<div class="table-responsive">
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th>Name</th>
        <th>Version</th>
        <th>Description</th>
        <th>Author</th>
        <th>Status</th>
        <th>Hooks</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {{range .Plugins}}
      <tr>
        <td>
          <a href="/admin/plugins/{{.Name}}">
            <strong>{{.Name}}</strong>
          </a>
        </td>
        <td>
          <span class="badge bg-info">{{.Version}}</span>
        </td>
        <td>{{.Description}}</td>
        <td>{{.Author}}</td>
        <td>
          {{.EnabledBadge}}
          {{.LoadedBadge}}
        </td>
        <td>
          {{range .Hooks}}
          <span class="badge bg-secondary">{{.}}</span>
          {{end}}
        </td>
        <td>
          <div class="btn-group btn-group-sm" role="group">
            <a
              href="/admin/plugins/{{.Name}}"
              class="btn btn-outline-primary"
              title="View Details"
            >
              <i class="bi bi-eye"></i>
            </a>
            {{if .Enabled}}
            <button
              hx-post="/admin/api/plugins/{{.Name}}/disable"
              hx-swap="none"
              hx-on::after-request="location.reload()"
              class="btn btn-outline-warning"
              title="Disable"
            >
              <i class="bi bi-pause-circle"></i>
            </button>
            {{else}}
            <button
              hx-post="/admin/api/plugins/{{.Name}}/enable"
              hx-swap="none"
              hx-on::after-request="location.reload()"
              class="btn btn-outline-success"
              title="Enable"
            >
              <i class="bi bi-play-circle"></i>
            </button>
            {{end}}
            <button
              hx-delete="/admin/api/plugins/{{.Name}}"
              hx-confirm="Are you sure you want to delete this plugin?"
              hx-swap="none"
              hx-on::after-request="location.reload()"
              class="btn btn-outline-danger"
              title="Delete"
            >
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </td>
      </tr>
      {{end}}
    </tbody>
  </table>
</div>
{{else}}
<div class="alert alert-info" role="alert">
  <i class="bi bi-info-circle"></i>
  No plugins registered. <a href="/admin/plugins/new">Add your first plugin</a>
</div>
{{end}}

<div class="mt-5">
  <h3>About Plugins</h3>
  <p class="text-muted">
    Plugins extend the gateway functionality by hooking into request/response lifecycle.
    Available hooks:
  </p>
  <ul class="text-muted">
    <li><strong>pre-request</strong> - Called before forwarding request to service</li>
    <li><strong>post-request</strong> - Called after receiving response from service</li>
    <li><strong>pre-response</strong> - Called before sending response to client</li>
    <li><strong>post-response</strong> - Called after sending response to client</li>
  </ul>
</div>
{{end}}
