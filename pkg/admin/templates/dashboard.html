{{define "dashboard.html"}}
{{template "base" .}}
{{end}}

{{define "title"}}Odin API Gateway - Dashboard{{end}}

{{define "container-class"}}container-fluid{{end}}

{{define "content"}}
<div id="service-list">{{template "service_list.html" .}}</div>

<template id="service-row-template">
  <tr>
    <td><strong>{name}</strong></td>
    <td><code>{basePath}</code></td>
    <td>{targets}</td>
    <td><span class="badge bg-success">Active</span></td>
    <td>
      <div class="btn-group btn-group-sm" role="group">
        <a href="/admin/services/{name}/edit" class="btn btn-outline-primary">Edit</a>
        <button
          type="button"
          class="btn btn-outline-danger"
          hx-delete="/admin/services/{name}"
          hx-confirm="Are you sure?"
          hx-target="#service-list"
          hx-trigger="click"
        >
          Delete
        </button>
      </div>
    </td>
  </tr>
</template>
{{end}}

{{define "scripts"}}
<script>
  function renderServiceList(services) {
    const template = document.getElementById('service-row-template').innerHTML;
    let html =
      '<table class="table table-striped"><thead><tr>' +
      '<th>Name</th><th>Base Path</th><th>Targets</th><th>Status</th><th>Actions</th>' +
      '</tr></thead><tbody>';

    services.forEach((service) => {
      let row = template
        .replace(/{name}/g, service.name)
        .replace(/{basePath}/g, service.basePath)
        .replace(/{targets}/g, service.targets.join(', '));
      html += row;
    });

    html += '</tbody></table>';
    document.getElementById('service-list').innerHTML = html;
  }
</script>
{{end}}
